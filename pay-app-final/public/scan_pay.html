<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>扫码支付</title>
  <link rel="stylesheet" href="./css/bootstrap.min.css"></link>
  <script src="./js/axios.min.js"></script>
  <script src="./js/qrcode.js"></script>
  <style rel="stylesheet">
    .qrcode {
      text-align: center;
    }

    .qrcode .qrcode-image {
      margin: 1rem auto;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="text-center">扫码支付</h1>
    <div class="form-group">
      <label class="form-label">价格</label>
      <input type="text" class="form-control" id="input-price" placeholder="请输入价格"></input>
    </div>
    <button class="btn btn-primary" onclick="subOrder(event)">下单</button>
    <hr>
    <div id="order" style="display: none;">
      <h3 class="text-center" id="orderPrice"></h3>
      <p>订单号：<span id="orderNo"></span></p>
      <div class="qrcode" id="qrcode">
        <img class="qrcode-image" id="qrcodeImage" src="" alt="">
      </div>
    </div>
    <!-- <script src="https://cdn.jsdelivr.net/npm/qrcodejs@1.0.0/qrcode.js"></script> -->
    <script type="text/javascript">
      function subOrder(event) {
        event.target.disabled = true
        const fee = document.querySelector('#input-price').value
        axios.post('/api/v1/wechats/pay-mock', { fee })
          .then(res => {
            console.log('result: ', res.data)
            document.querySelector('#order').style.display = 'block'
            document.querySelector('#orderPrice').innerHTML = fee
            document.querySelector('#orderNo').innerHTML = res.data.data.orderNo

            console.log('codeUrl: ', res.data.data.codeUrl)
           
            const img = document.getElementById('qrcodeImage');
            QRCode.toDataURL(res.data.data.codeUrl, {
              width: 200,
              margin: 2,
              color: {
                dark: '#000000',
                light: '#ffffff'
              }
            }, function (error, url) {
              if (error) console.error(error);
              else img.src = url; // 将Base64图片赋值给img
            });

            console.log('qrcode : ', qrcode)
          })
          .catch(err => {
            alert('下单失败，请重试')
            event.target.disabled = false
          })
      }
    </script>
  </div>
</body>
</html>